{% extends 'base.html' %}
{% block content %}
<div class="container mt-5 text-center">
    
    <h2 class="mb-4">Уникальные иероглифы</h2>

    <form id="character-form">
        <ol id="character-list" class="list-group mx-auto" style="max-width: 400px;">
            {% for index, char in enumerate(characters, start=1) %}
                <li class="list-group-item">
                    <label class="checkbox-container">
                        <input type="checkbox" class="custom-checkbox" name="selected_chars" value="{{ char }}">
                        <span class="checkmark"></span>
                    </label>
                    <span class="character-text">{{ index }}. {{ char }}</span>
                </li>
            {% endfor %}
        </ol>
    </form>

    <!-- Группа кнопок "Копировать всё" -->
    <div class="mb-4">
        <h5 class="mb-3">Копировать всё</h5>
        <div class="d-flex justify-content-center gap-2">
            <button id="copy-button" class="btn btn-outline-success btn-sm">Копировать всё</button>
            <button id="copy-all-no-numbers" class="btn btn-outline-success btn-sm">Копировать всё без нумерации</button>
            <button id="copy-all-horizontal" class="btn btn-outline-info btn-sm">Копировать по горизонтали (без нумерации)</button>
            <button id="copy-all-vertical" class="btn btn-outline-info btn-sm">Копировать по вертикали (без нумерации)</button>
        </div>
    </div>

    <!-- Группа кнопок "Копировать выбранные" -->
    <div class="mb-4">
        <h5 class="mb-3">Копировать выбранные</h5>
        <div class="d-flex justify-content-center gap-2">
            <button id="copy-selected-button" class="btn btn-outline-warning btn-sm">Копировать выбранные</button>
            <button id="copy-selected-no-numbers" class="btn btn-outline-warning btn-sm">Копировать выбранные без нумерации</button>
            <button id="copy-selected-horizontal" class="btn btn-outline-info btn-sm">Копировать выбранные (по горизонтали)</button>
            <button id="copy-selected-horizontal-no-numbers" class="btn btn-outline-info btn-sm">Копировать по горизонтали (без нумерации, выбранные)</button>
            <button id="copy-selected-vertical" class="btn btn-outline-info btn-sm">Копировать по вертикали (без нумерации, выбранные)</button>
        </div>
    </div>

    <!-- Группа кнопок "Дополнительные действия" -->
    <div class="mb-4">
        <h5 class="mb-3">Дополнительные действия</h5>
        <div class="d-flex justify-content-center gap-2">
            <button id="clear-checkboxes-button" class="btn btn-outline-danger btn-sm">Очистить чекбоксы</button>
            <button id="download-selected-button" class="btn btn-outline-primary btn-sm">Скачать выбранные в Word</button>
            <a href="{{ url_for('download') }}" class="btn btn-outline-info btn-sm">Скачать все в Word</a>
        </div>
    </div>


    <div class="mt-4">
        <a href="{{ url_for('clear') }}" class="btn btn-danger">Очистить все слова</a>
    </div>
</div>

<script>
    // Универсальная функция для копирования текста
    function copyToClipboard(text) {
        const tempInput = document.createElement('textarea');
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        alert('Текст скопирован в буфер обмена!');
    }

    // Копировать все иероглифы
    document.getElementById('copy-button').addEventListener('click', function() {
        const allCharacters = Array.from(document.querySelectorAll('.character-text'))
                                   .map(el => el.textContent.trim());
        copyToClipboard(allCharacters.join('\n'));
    });

    // Копировать все иероглифы без нумерации
    document.getElementById('copy-all-no-numbers').addEventListener('click', function() {
        const allCharacters = Array.from(document.querySelectorAll('.character-text'))
                                   .map(el => el.textContent.replace(/^\d+\.\s*/, '').trim());
        copyToClipboard(allCharacters.join('\n'));
    });

    // Копировать все иероглифы по горизонтали (без нумерации)
    document.getElementById('copy-all-horizontal').addEventListener('click', function() {
        const allCharacters = Array.from(document.querySelectorAll('.character-text'))
                                   .map(el => el.textContent.replace(/^\d+\.\s*/, '').trim());
        copyToClipboard(allCharacters.join('\t'));
    });

    // Копировать выбранные иероглифы по горизонтали (без нумерации)
    document.getElementById('copy-selected-horizontal-no-numbers').addEventListener('click', function() {
        const selectedCharacters = Array.from(document.querySelectorAll('input[name="selected_chars"]:checked'))
                                        .map(checkbox => checkbox.value.trim());
        if (selectedCharacters.length === 0) {
            alert('Пожалуйста, выберите хотя бы один иероглиф.');
            return;
        }
        copyToClipboard(selectedCharacters.join('\t'));
    });

    // Копировать все иероглифы по вертикали (без нумерации)
    document.getElementById('copy-all-vertical').addEventListener('click', function() {
        const allCharacters = Array.from(document.querySelectorAll('.character-text'))
                                   .map(el => el.textContent.replace(/^\d+\.\s*/, '').trim());
        copyToClipboard(allCharacters.join('\n'));
    });

    // Копировать выбранные иероглифы по вертикали (без нумерации)
    document.getElementById('copy-selected-vertical').addEventListener('click', function() {
        const selectedCharacters = Array.from(document.querySelectorAll('input[name="selected_chars"]:checked'))
                                        .map(checkbox => checkbox.value.trim());
        if (selectedCharacters.length === 0) {
            alert('Пожалуйста, выберите хотя бы один иероглиф.');
            return;
        }
        copyToClipboard(selectedCharacters.join('\n'));
    });

    // Копировать выбранные иероглифы
    document.getElementById('copy-selected-button').addEventListener('click', function() {
        const selectedCharacters = Array.from(document.querySelectorAll('input[name="selected_chars"]:checked'))
                                        .map(checkbox => checkbox.nextElementSibling.parentElement.nextElementSibling.textContent.trim());
        if (selectedCharacters.length === 0) {
            alert('Пожалуйста, выберите хотя бы один иероглиф.');
            return;
        }
        copyToClipboard(selectedCharacters.join('\n'));
    });

    // Очистить чекбоксы
    document.getElementById('clear-checkboxes-button').addEventListener('click', function() {
        const checkboxes = document.querySelectorAll('input[name="selected_chars"]');
        checkboxes.forEach(checkbox => checkbox.checked = false);
        alert('Все чекбоксы очищены!');
    });

    // Скачать выбранные иероглифы в Word
    document.getElementById('download-selected-button').addEventListener('click', function() {
        const selectedCharacters = Array.from(document.querySelectorAll('input[name="selected_chars"]:checked'))
                                        .map(checkbox => checkbox.value);

        fetch('/download_selected', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ characters: selectedCharacters })
        })
        .then(response => {
            if (!response.ok) throw new Error('Не выбраны символы');
            return response.blob();
        })
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'selected_characters.docx';
            document.body.appendChild(a);
            a.click();
            a.remove();
        })
        .catch(error => alert(error.message));
    });
</script>
{% endblock %}
